<!-- +=====================================================================+ -->
<!-- |                                                                     | -->
<!-- |                      - w i n d o w s . x m l                        | -->
<!-- |                                                                     | -->
<!-- +=====================================================================+ -->
<!-- |                                                                     | -->
<!-- | This Ant file drives Audiveris installation on Windows environment  | -->
<!-- | -windows.xml    This Ant file                                       | -->
<!-- |                                                                     | -->
<!-- +=====================================================================+ -->

<project name="windows" basedir="../..">
  
    <description>
        All targets specific to Windows platform.
    
        Targets are presented in alphabetical order, regardless of initial '-'.
        An initial '-' indicates an internal target.
    </description>

    <!-- ===  Internal Targets  ============================================ --> 
  
    <!-- ========= -->
    <!--  - B A T  -->
    <!-- ========= -->
    <target name="-bat">
        <echo message="-- Building ${name}.bat" />
        <!-- TODO add -splash:path/to/splash.png -->
        <echo file="${basedir}/${name}.bat" append="false"><![CDATA[start "Audiveris" javaw -version:1.7+ -Xms512M -Xmx512M -jar "%~dp0/dist/audiveris.jar" %1 %2 %3 %4 %5 %6 %7 %8 %9]]>
        </echo>    
    </target>

    <!-- ============= -->
    <!--  - C L E A N  -->
    <!-- ============= -->
    <target name="-clean">
        <!-- Remove all the generated outputs for Windows -->
        <delete verbose="${verbose}" quiet="true">
            <fileset dir="${basedir}" includes="*.bat"/>
        </delete> 
    </target>
   
    <!-- ===================== -->
    <!--  - C O P Y - E V A L  -->
    <!-- ===================== -->
    <target name="-copy-eval">
        <!-- Copy the local eval content (if any) to res folder -->
        <copy verbose="${verbose}" todir="${res.dir}" overwrite="true">
            <fileset dir="${eval.dir}" includes="neural-network.xml"/>
            <fileset dir="${eval.dir}" includes="linear-evaluator.xml"/>
        </copy> 
    </target>
  
    <!-- =========================== -->
    <!--  - D O - I N S T A L L E R  -->
    <!-- =========================== -->
<!--    <target name="-do-installer"
            depends="-candle, -bundle, -wix-cleanup"/>   -->
<!--            depends="-candle, -audiveris-msi, -bundle, -wix-cleanup"/>   -->
  
    <!-- ============================= -->
    <!--  - D O - I N S T A L L E R S  -->
    <!-- ============================= -->
    <target name="-do-installers">
    
        <!-- Installer for x86 -->
        <antcall target="-do-installer">
            <param name="arch" value="x86" />
            <param name="bits" value="32bit" />
        </antcall>
    
        <!-- Installer for x64 -->
        <antcall target="-do-installer">
            <param name="arch" value="x64" />
            <param name="bits" value="64bit" />
        </antcall>
    
    </target>
   
    <!-- ======================= -->
    <!--  - I N S T A L L E R S  -->
    <!-- ======================= -->
    <!-- Build Windows installers for x86 and x64 architectures-->
    <target name="-installers"
            depends="-bat, -copy-eval, -do-installers"/>

    <!-- =========================== -->
    <!--  - D O - P A C K - L I B S  -->
    <!-- =========================== -->
    <!-- Pack all native libs of an arch into a .jar file -->
    <target name="-do-pack-libs">
        <echo message="-- Packing up DLLs for ${bits}" />
        <jar destfile="dist/lib/tess-windows-${bits}.jar">
            <fileset dir="dev/windows/dll/${bits}" />
        </jar>
    </target>
    
    <!-- ===================== -->
    <!--  - P A C K - L I B S  -->
    <!-- ===================== -->
    <target name="-pack-libs">
        <!-- Libs for x86 -->
        <antcall target="-do-pack-libs">
            <param name="bits" value="32bit" />
        </antcall>
    
        <!-- Libs for x64 -->
        <antcall target="-do-pack-libs">
            <param name="bits" value="64bit" />
        </antcall>
    </target>        

</project>
