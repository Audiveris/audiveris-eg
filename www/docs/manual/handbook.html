<!DOCTYPE html>
<!-- ======================================================================= -->
<!--                        h a n d b o o k . h t m l                        -->
<!-- ======================================================================= -->
<html>
    <head>
        <title>
            Audiveris - Handbook
        </title>
        <script type="text/javascript">
            //<![CDATA[
            context = {page:"Handbook", root:"../../"};
            //]]>
        </script>
        <meta name="description" content="How to operate Audiveris" />
        <meta name="author" content="HervÃ© Bitteur" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="icon" href="../../branding/images/audiveris-icons-256.ico"
              type="image/x-icon" />

        <link rel="stylesheet" href="../../branding/css/global.css" />
        <link rel="stylesheet" href="../../branding/css/title-numbering.css" />
        <link rel="stylesheet" href="../../branding/css/nav.css" />

        <style type="text/css">
            /*<![CDATA[*/
            /*            @page { 
                            margin-left: 1cm; 
                            margin-right: 1cm; 
                            margin-top: 2cm; 
                            margin-bottom: 1cm 
                        }*/

            div.main {
                margin-top: 0px;
                margin-right:20px;
            }

            h1 {
                font-size: 6em;
                text-align: right;
            }

            /* -- ids -- */

            #cover-page {
                margin-right: 20px;
            }
            #cli-snippet {
                width: 88%;
                margin-left: 20px;  
            }
            #java-snippet {
                width: 450pt;
            }
            #logo-img {
                box-shadow: none;
            }
            #plugins-right {
                width: 55%;
            }
            #plugins-snippet {
                margin: 0;
            }
            #script-snippet {
                width: 85%;
            }
            #warped{
                margin-right: 10px;
            }
            #dewarped {
                margin-left: 10px;
            }
            /*]]>*/
        </style>
    </head>
    <body>
        <div id="navigation">
            <br/>
            <a href="#content">Handbook</a>
            <ol>
                <li><a href="#getting-started">Getting started</a>
                    <ul>
                        <li><a href="#installation">Installation</a>
                            <ul>
                                <li><a href="#windows">Windows</a>
                                    <ul>
                                        <li><a href="#launching-audiveris">Launching</a></li>
                                    </ul>
                                </li>
                                <li><a href="#linux">Linux</a></li>
                            </ul>
                        </li>
                        <li> <a href="#tessdata">OCR languages</a></li>
                        <li><a href="#loading-an-image">Loading an image</a></li>
                        <li><a href="#transcription">Transcription</a>
                            <ul>
                                <li><a href="#main-window-layout">Window layout</a></li>
                                <li><a href="#sheet-display-modes">Display modes</a></li>
                            </ul>
                        </li>
                        <li><a href="#outputs">Outputs</a></li>
                    </ul>
                </li>
                <li><a href="#basics">Basics</a>
                    <ul>
                        <li><a href="#entities">Entities</a></li>
                        <li><a href="#tools">User tools</a>
                            <ul>
                                <li><a href="#selections">Selections</a></li>
                                <li><a href="#boards">Boards</a></li>
                                <li><a href="#context-menu">Context menu</a></li>
                                <li><a href="#score-parameters">Score parameters</a></li>
                                <li><a href="#errors-window">Error window</a></li>
                            </ul>
                        </li>
                        <li><a href="#glyph-merge">Merge</a></li>
                        <li><a href="#glyph-assignment">Assignment</a></li>
                        <li><a href="#glyph-split">Split</a></li>
                        <li><a href="#glyph-insertion">Insertion</a></li>
                        <li><a href="#text-correction">Text correction</a></li>
                    </ul>
                </li>
                <li><a href="#advanced">Advanced</a>
                    <ul>
                        <li><a href="#cli">Command line</a></li>
                        <li><a href="#script">Script</a></li>
                        <li><a href="#plugins">Plugins</a></li>
                        <li><a href="#options">Options</a></li>
                        <li><a href="#training">Training</a>
                            <ul>
                                <li><a href="#persist-manuals">Persistence</a></li>
                                <li><a href="#save-score-samples">Saving samples</a></li>
                                <li><a href="#sample-verifier">Sample verifier</a></li>
                                <li><a href="#trainer">Trainer</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><a href="#internals">Internals</a>
                    <ul>
                        <li><a href="#load-step">Load</a></li>
                        <li><a href="#scale-step">Scale</a></li>
                        <li><a href="#grid-step">Grid</a></li>
                        <li><a href="#systems-step">Systems</a></li>
                        <li><a href="#measures-step">Measures</a></li>
                        <li><a href="#texts-step">Texts</a></li>
                        <li><a href="#sticks-step">Sticks</a></li>
                        <li><a href="#symbols-step">Symbols</a></li>
                        <li><a href="#pages-step">Pages</a></li>
                        <li><a href="#score-step">Score</a></li>
                    </ul>
                </li>
            </ol>
        </div>

        <div class="main" id="content">
            <div id="cover-page">
                <div id="cover-logo">
                    <img id="logo-img" alt="logo" src=
                         "../../branding/images/logo-audiveris-195x80.png" />
                </div>Open Music Scanner
                <hr/>
                <h1>
                    Handbook
                </h1>
                This documentation applies to Audiveris version 4.2 and above.
            </div>
            <!-- =========================================================== -->
            <h2 id="getting-started" class="chapter">
                Getting started
            </h2>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="installation">
                Installation
            </h3>
            <p>
                This version of Audiveris runs on Windows and Linux system
                environments.
            </p>
            <h4 id="windows">
                Windows
            </h4>
            <img class="side" width="305" height="239" title="Welcome screen" 
                 alt="msi-welcome" src="../images/msi-welcome.png" />
            <p>
                For Windows users, a Microsoft Installer file is available in
                the <a href=
                       "http://kenai.com/projects/audiveris/downloads">download
                    area</a> of Audiveris project. Select the latest version
                with a <code>.msi</code> extension and click on the link to
                start the download.
            </p>
            <p>
                When the download is complete, simply start the installation by
                a double click on the downloaded file.
            </p>

            <br class="clear"/>
            <img class="side" width="305" height="239" title="License screen" 
                 alt="msi-license" src="../images/msi-license.png" />
            <p>
                The next screen allows to browse the Audiveris license (GNU GPL
                V2). If you agree with the license, check the dedicated check
                box and proceed to the next installation screen.
            </p>

            <br class="clear"/>
            <img class="side" width="305" height="239" title="Setup selection" 
                 alt="msi-choose-setup" src="../images/msi-choose-setup.png" />
            <p>
                The next screen allows to select the proper setup (typical,
                custom or complete)
            </p>

            <br class="clear"/>
            <img class="side" width="305" height="239" title="Optional components" 
                 alt="msi-custom-setup" 
                 src="../images/msi-custom-setup.png" />
            <p>
                If you select the custom setup, you have the ability to choose
                the installation location and decide on the installation of
                optional components (Examples, Plugins, Training material).
            </p>
            <p>
                Note that you can always change your mind later and add or
                remove some or all of these optional components. To do so,
                simply relaunch the installer program, it will prompt you for
                your new decisions.
            </p>
            <h5 id="launching-audiveris">
                Launching Audiveris
            </h5>
            <p>
                To launch Audiveris under Windows use:
            </p>
            <div class="code">
                <code>Start</code> | <code>All Programs</code> | 
                <code>audiveris</code> | <code>audiveris application</code>
            </div>
            <p>
                There are other ways to launch Audiveris, for example to open a
                Console, to run in batch, to specify launch parameters, etc.
                These other ways are described in the <a href="#cli">Command
                    Line Interface</a> section of the Advanced chapter.
            </p>
            <div id="java-snippet" class="snippet">
                <strong>Java check:</strong>
                <img class="right" width="375" height="154"
                     title="Java runtime" alt="java-requirement" 
                     src="../images/java-requirement.png" />
                <p>
                    At the very first launch, your computer system will be
                    checked for the needed Java runtime (Java 7 as of this
                    writing). If the check fails, you will be prompted by a 
                    Launch4j dialog.
                </p>
                <p>
                    By a click on the OK button, you will be connected to the
                    Java download page. 
                </p>
                <ol>
                    <li>Make sure to select the Java 7 link
                        (and not Java 6) and choose either the JRE or JDK.</li>
                    <li>Download the proper file, Windows x86 (32-bit) or 
                        Windows x64 (64-bit), according to your computer 
                        hardware architecture.</li>
                    <li>A double click on the downloaded file will install the
                        Java environment.</li>
                    <li>When the Java installation completes, relaunch 
                        Audiveris.</li>
                </ol>
            </div>
            <h4 id="linux">
                Linux
            </h4>
            <p>
                For Linux, there is yet no integrated installer similar to what
                we have for Windows system. For the time being, you have to
                build the application from the sources.
            </p>
            <p>
                The source distribution is available on the 
                <a href="http://kenai.com/projects/audiveris/downloads">
                    download area</a> of Audiveris project and matches the
                <code>audiveris-V.v.revision-src.zip</code> naming
                schema.
                <br/>
                Download the distribution file, create a dedicated directory
                and expand the downloaded file into this directory.
                <br/>
                For further information, see the <a href="#building">Building
                </a> section.
            </p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="tessdata">
                OCR languages
            </h3>
            <p>
                Audiveris uses Tesseract as the OCR engine to retrieve and
                transcribe all score text items.
            </p>
            <p>
                Since OCR language files can exhibit huge sizes, only selected
                languages are contained in Audiveris installation package.
                The default languages are: deu, eng, fra et ita.
            </p>
            <p>
                Your can simply download additional languages and put them
                into the <code>ocr/tessdata</code> folder.
                All languages files are available for download on the
                <a href="http://code.google.com/p/tesseract-ocr/downloads/list">
                    Tesseract site</a>.
            </p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="loading-an-image">
                Loading an image
            </h3>
            <img class="side" width="251" height="139" title="Input selection" 
                 alt="chula-input" src="../images/chula-input.png" />
            <p>
                The main purpose of a music scanner like Audiveris is to
                analyze the image of a sheet of music and transcribe it to the
                standard symbolic format that all other music applications can
                read and write for further processing.
            </p>
            <p>
                To load an image, use the menu <code>File </code> | <code> 
                    Input</code> and select some input file.
            </p>
            <p>
                Another way to load an input file, is to directly use a drag n'
                drop from the file explorer to the Audiveris application window.
            </p>
            <br class="clear"/>
            <p>
                A few hints:
            </p>
            <ul>
                <li>All major formats are supported, notably PDF, TIFF, JPG,
                    PNG, BMP.
                </li>
                <li>Prefer gray level images, with pixels value in the 0 - 255
                    range, to black and white images.
                    Color images are supported as well.
                </li>
                <li>If you scan paper sheets by yourself, pay attention to the
                    scan resolution. Best results are obtained with resolution
                    around 300 DPI. Lower resolutions may hide key details while
                    higher ones turn quickly into a significant waste of CPU and
                    memory resources.
                </li>
            </ul>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="transcription">
                Transcription
            </h3>
            <img class="side" title="Transcribe" width="307" height="259"
                 alt="transcribe" src="../images/chula-build-score.png" />
            <p>
                To launch the image transcription, use the menu <code> Score 
                </code>|<code> Transcribe</code>.
            </p>
            <p>
                The same action can be launched directly from the toolbar icon
                <img class="icon" width="16" height="16" 
                     src="../images/StepForward16.gif" />
            </p>
            <br class="clear"/>

            <img class="right" title="Step selection" width="177" height="363"
                 alt="score-step" src="../images/chula-score-step.png" />
            <p>
                You can as well select the SCORE target through the menu 
                <code> Step </code>|<code> SCORE</code>.
            </p>
            <p>
                Don't get too impressed by the list of steps available:
            </p>
            <ul>
                <li>All steps from <code>LOAD</code> to <code>SCORE</code> are 
                    the mandatory steps. 
                    In fact they will be processed as needed in sequence when 
                    some output is asked for.
                    See the <a href="cli">Command Line Interface</a> section for
                    a quick presentation of the steps sequence and the 
                    <a href="internals">Internals</a> chapter for further 
                    details.</li>
                <li>The subsequent steps (<code>PRINT</code>, <code>EXPORT</code>,
                    <code>PLUGIN</code>), those displayed after the separating 
                    line in the step menu, represent the actual outputs. 
                    These are the steps that a casual user is interested in.</li>
            </ul>

            <h4 id="main-window-layout">
                Main window layout
            </h4>
            <img class="right" width="650" height="520" 
                 src="../images/chula-score.png"
                 alt="score" title="Application main window"/>
            <p>
                Within a few seconds after selecting the <code>SCORE</code> step
                (or any other subsequent step) you should get a screen similar 
                to this picture.
            </p>
            <p>
                Since version 4, Audiveris has merged the former sheet and score
                views into a single panel. 
                This saves screen space and allows quick visual checking.
            </p>
            <p>
                Audiveris main window is now composed of 4 panels:
            </p>
            <dl>
                <dt>Sheet</dt>
                <dd>
                    This is the large panel in the upper left corner.
                    <br/>
                    The <code>Picture</code> tab presents the input image,
                    while the <code>Data</code> tab presents the objects
                    (sections and glyphs) extracted from the image. In the
                    <code>Data</code> tab, the objects representing staff lines
                    or stems are drawn as thin lines.
                </dd>
                <dt>Boards</dt>
                <dd>
                    The right panel is a vertical set of boards, that are used
                    as both user input and output. Only basic boards are
                    displayed by default. A right click in this column allows
                    to display or hide selected boards.
                </dd>
                <dt>Events</dt>
                <dd>
                    The lower left panel is a log of the main events that
                    occurred so far.
                </dd>
                <dt>Errors</dt>
                <dd>
                    The lower middle panel displays a sorted list of detected
                    errors. A click on an error line in this panel moves you to
                    the related location in the sheet panel.
                </dd>
            </dl>

            <h4 id="sheet-display-modes">
                Sheet display modes
            </h4>
            <table class="side" border="0" cellspacing="20px">
                <tr>
                    <th></th>
                    <th>Picture tab</th>
                    <th>Data tab</th>
                </tr>
                <tr>
                    <th>Physical mode</th>
                    <td>
                        <img src="../images/picture-physical.png" alt=
                             "pic-physical" />
                    </td>
                    <td>
                        <img src="../images/data-physical.png" alt=
                             "data-physical" />
                    </td>
                </tr>
                <tr>
                    <th>Combined mode</th>
                    <td>
                        <img src="../images/picture-combined.png" alt=
                             "pic-combined" />
                    </td>
                    <td>
                        <img src="../images/data-combined.png" alt=
                             "data-combined" />
                    </td>
                </tr>
                <tr>
                    <th>Logical mode</th>
                    <td>
                        <img src="../images/picture-logical.png" alt=
                             "pic-logical" />
                    </td>
                    <td>
                        <img src="../images/data-logical.png" alt=
                             "data-logical" />
                    </td>
                </tr>
            </table>
            <p>
                For the sheet panel you can choose between 3 display modes:
            </p>
            <ul>
                <li>The <code>physical</code> mode displays the sheet glyphs
                    colorized according to their recognized shape and using 
                    their physical coordinates.
                </li>
                <li>The <code>logical</code> mode displays the logical score
                    entities built from the interpretation of the physical 
                    glyphs.
                </li>
                <li>The <code>combined</code> mode is a combination of the
                    physical and logical layers. It displays the logical 
                    entities in a translucent manner on top of the physical 
                    glyphs.
                </li>
            </ul>
            <p>
                Using the menu <code>Views</code> | <code>Switch layers</code> 
                you can circle through 
                the different modes <code>Physical</code> /
                <code>Combined</code> / <code>Logical</code>.
                <br>
                You can also use the <code class="key">F12</code> function key
                or the related toolbar icon
                <img class="icon" width="16" height="16" 
                     src="../images/Search16.gif" />
            </p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="outputs">
                Outputs
            </h3>
            <p>The transcription data, which results from the SCORE step, can
                then be further used by:
            </p>
            <img class="side" title="Plugin selection" width="241" height="146"
                 alt="musescore" src="../images/plugin-musescore.png" />
            <ul>
                <li>The <b>PRINT</b> step (or the menu <code>Score</code> |
                    <code>Print...</code>) writes the resulting image into a
                    PDF file. The image is basically the content of the
                    <code>Picture</code> tab in <code>logical</code> mode.
                </li>
                <li>The <b>EXPORT</b> step (or the menu <code>Score</code> |
                    <code>Export...</code>) writes a MusicXML file with the
                    exported score entities.
                </li>
                <li>The <b>PLUGIN</b> step (or any <b>plugin</b> accessed
                    through the <code>Plugins</code> menu) launches a plugged
                    application on the exported MusicXML file. Refer to the 
                    <a href="#plugins">Plugins section</a> for further details.
                    <br/>
                </li>
            </ul>
            <p>
                Note there is no need to manually go through the intermediate
                steps. For example, loading an input file and selecting a
                plugin will trigger the steps from SCALE through SCORE + EXPORT
                + the selected plugin.
            </p>

            <!-- =========================================================== -->

            <h2 id="basics" class="chapter">
                Basics
            </h2>
            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="entities">
                Entities
            </h3>
            Let's introduce a short number of basic concepts:
            <img class="right" width="476" height="314"
                 title="Pixels, Runs & Sections" alt="runs-and-sections"
                 src="../images/runs-and-sections.png" />
            <dl>
                <dt>Pixel</dt>
                <dd>A pixel is the smallest picture element in the input image. 
                    A pixels exhibits a specific color, generally a level of 
                    gray.
                    Using a binarization threshold, we can separate foreground 
                    (black) pixels from background (white) pixels.</dd>
                <dt>Run</dt>
                <dd>A run is a horizontal or vertical vector of pixels of the
                    same color. A black pixel is "assigned" to exactly one run.
                </dd>
                <dt>Section</dt>
                <dd>A section is a sequence of adjacent black runs, all of the
                    same orientation. A run belongs to exactly one section.</dd>
                <dt>Glyph</dt>
                <dd>A glyph is nothing but a set of sections, perhaps from
                    different orientations. A section may belong to many 
                    overlapping glyphs at the same time, but is assigned at any
                    moment to at most one (active) glyph.</dd>
            </dl>
            <br class="clear" />
            <img class="side" title="Horizontal & vertical sections" 
                 width="247" height="225"
                 alt="sections" src="../images/sections.png" />
            <p >
                The following picture presents sections at the end of the 
                <code>GRID</code> step.
                We can observe:
            </p>
            <ul>
                <li>Unassigned vertical sections, displayed in light blue.</li>
                <li>Unassigned horizontal sections, displayed in light pink.</li>
                <li>Horizontal sections assigned to staff line glyphs, and
                    displayed in ivory color.</li>
            </ul>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

            <h3 id="tools">
                Main user tools
            </h3>

            <h4 id="selections">
                Selections
            </h4>
            <p>There are 2 selections modes, glyph-based (the default) or 
                section-based.
                <br/>
                To switch from one mode to the other, use the toggle menu item
                <code>Views</code> | <code>Enable section selection</code> 
                or the related toolbar icon
                <img class="icon" width="16" height="16" 
                     src="../images/Application16.gif" />
            </p>
            <p>
                In section selection mode, section boundaries are shown while
                these boundaries do not appear in glyph selection mode.
                And the mouse-based selection works as expected, pointing to
                either glyph entities or section entities.
            </p>
            <p>
                A left-click in an entity area selects this entity 
                (and deselects the entity previously selected if any).
            </p>
            <p>To select several entities:</p>
            <ul>
                <li>Either select each entity, one after the other, keeping the 
                    <code class="key">CTRL</code> key pressed.</li>
                <li>Or, by  dragging the mouse while keeping the 
                    <code class="key">SHIFT</code> key pressed, use a 
                    rectangular "lasso" to grab all the entities whose bounds 
                    are fully contained by the lasso rectangle.</li>
            </ul>

            <div id="boards">
                <h4>
                    Boards
                </h4>

                <img class="right" title="boards" alt="boards" 
                     width="301" height="581" src="../images/boards.png"/>
                <img class="right" title="Boards selection" 
                     width="175" height="286"
                     src="../images/boards-selection.png" />

                <p>By a right-click in boards pane, you get access to
                    boards selection, to customize which boards should be 
                    displayed or hidden:
                </p>

                <dl>
                    <dt>Pixel</dt>
                    <dd>Displays the current position (point or rectangle)
                        in pixels.
                        The <code>Level</code> field gives the level of
                        gray for the selected pixel. 
                        Note that apart <code>Level</code>, all the other 
                        fields are both output and input fields. 
                        Just modify their values and press return to modify
                        the selected location.</dd>

                    <dt>Run (Hori/Vert)</dt>
                    <dd>Displays the current black Run (horizontal or vertical)
                        if any.</dd>

                    <dt>Section (Hori/Vert)</dt>
                    <dd>Display the current Section (horizontal or vertical) 
                        if any. 
                        The <code>Id</code> field is both output and input,
                        so a section can be directly selected via its ID.
                    </dd>

                    <dt>Glyph</dt>
                    <dd>Displays parameters of the selected Glyph if any.
                        <br/>
                        A glyph is collection of sections, and it is never
                        deleted, therefore it is always accessible via its 
                        <code>Id</code>.
                        <br/>
                        A glyph is said <code>Active</code> if its sections 
                        point back to it, so the selection of one of its 
                        sections will select that glyph.</dd>

                    <dt>Focus</dt>
                    <dd>Allows to browse the whole sheet for specific 
                        shapes.</dd>

                    <dt>Eval</dt>
                    <dd>Displays the result of the glyph evaluation by the 
                        neural network evaluator.
                        <br/>
                        The top 5 best shapes are displayed, with their 
                        related grade in range 0..100.
                        A red background color indicates a shape manually
                        discarded.
                    </dd>

                    <dt>Shape</dt>
                    <dd>The shape palette gives access to shape families.
                        Within a family, a shape can be assigned 
                        (by double-click) or dragged and dropped to a target
                        location.</dd>

                    <dt>Check</dt>
                    <dd>There are several Check boards (Barline, Stem,
                        Ledger). They are meant for the advanced user.</dd>
                </dl>
            </div>

            <div id="context-menu">
                <h4>
                    Context menu
                </h4>

                <img class="side" title="Context menu" width="426" height="410"
                     src="../images/context-menu.png" />

                <p>With a right click in the sheet view, you get a popup menu
                    whose content depends on the current context, notably the 
                    selected glyph if any.
                </p>

                <p>
                    Here are the main possibilities:
                </p>
                <dl>
                    <dt>Measure #m...</dt>
                    <dd>Information / actions on the current measure.
                        <br/>
                        Note that the displayed measure number is local to the 
                        current page even though the exported measure number 
                        will be score based. 
                        The difference is noticeable only in a multi-page score.
                    </dd>

                    <dt>Slot #s...</dt>
                    <dd>Information / actions on the current time slot within
                        the current measure.</dd>

                    <dt>Glyphs...</dt>
                    <dd>If a glyph is selected, as depicted in the example shown,
                        many glyph-related actions are enabled, depending on the
                        number of selected glyphs.</dd>

                    <dt>Boundaries...</dt>
                    <dd>This allows to start or stop a series of manual 
                        modifications of system boundaries. 
                        By dragging system boundaries, you can manually and 
                        very precisely define the boundaries.
                        When you are done with boundaries modification, stop the
                        session in order to trigger all needed recomputations.
                    </dd>

                </dl>
            </div>

            <h4 id="score-parameters">
                Score parameters
            </h4>
            <img title="Score parameters" class="right" 
                 width="382" height="445"
                 src="../images/chula-parameters.png" />
            <p>This convenient dialog box gathers a selected number of global
                and key score parameters.
                It can be accessed through menu <code>Score</code> | 
                <code>Set parameters...</code> or via the related toolbar icon 
                <img class="icon" width="16" height="16" 
                     src="../images/Edit16.gif" />
            </p>
            <ol>
                <li>Global parameters (they concern the whole application):
                    <dl>
                        <dt>Call-Stack</dt>
                        <dd>Print out the calling stack whenever some exception
                            is thrown</dd>
                        <dt>Script</dt>
                        <dd>Prompt the user for saving the current script when
                            closing a score</dd>
                        <dt>Drag n' Drop</dt>
                        <dd>Define the default step to be performed when an
                            input file is dropped on the application window</dd>
                    </dl>
                </li>
                <li>Key score parameters (they concern just the current score,
                    unless the box <code>Set as default</code> is checked):
                    <dl>
                        <dt>Foreground Pixels</dt>
                        <dd>Define the threshold on gray level to separate
                            foreground pixels (level &lt;= threshold) and 
                            background pixels (level &gt; threshold)</dd>
                        <dt>Time Slots</dt>
                        <dd>Define the abscissa margin around time slots
                            (expressed in interline fraction)</dd>
                        <dt>Text</dt>
                        <dd>Define the dominant language for OCR'ed text</dd>
                        <dt>Parts</dt>
                        <dd>Define name and MIDI instrument for each part</dd>
                    </dl>
                </li>                
            </ol>

            <h4 id="errors-window">
                Errors window
            </h4>
            <p>The <code>PAGES</code> and <code>SCORE</code> steps are able to 
                detect possible errors and sometimes to correct them
                automatically.
                Remaining errors are displayed in the error window located at
                the bottom of the main window.</p>
            <img class="side" title="Errors window" alt="errors-window"
                 width="356" height="99"
                 src="../images/errors-window.png" />
            <p>The picture next to this paragraph presents the content of this 
                window after running <code>SCORE</code> on the example image.
                If the windows is not displayed, make sure to open it through 
                menu <code>Views</code> | <code>Display errors window</code>.
            </p>
            <p>The errors list is sorted, and every error message begins 
                with a context indication.
            </p>
            <p>For example, the third error says: <code>S3P1M*14 
                    [glyph#3174] PAGES Dot unassigned</code>.
            </p>
            <ol>
                <li>The location of this message is coded as
                    <code>S3P1M*14</code> (System 3, Part 1, Measure 14).
                    The measure number is local to the page, and flagged
                    as such by the '*' character in <code>M*14</code>.
                </li>
                <li>There is also a glyph reference: <code>glyph#3174</code>
                </li>
                <li>The step which has detected the error: <code>PAGES</code>
                <li>Finally the message itself: <code>Dot unassigned</code>.
                </li>
            </ol>
            <p>For any error in the list, simply clicking on it will move the 
                current focus to where the program thinks the error is located.
            </p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="glyph-merge">
                Glyph merge
            </h3>
            <img class="side" title="dot-unassigned" alt="dot-assigned"
                 width="390" height="277" src="../images/dot-unassigned.png" />
            <p>Let us take the third error signalled in the error window (Dot 
                unassigned).
            </p>
            <p>A dot-shaped glyph is expected to be assigned a precise 
                shape (augmentation dot, repeat dot, staccato) depending on
                the surrounding entities.
                Here none of these assignments was found acceptable.
                It's a hint that the glyph <code>#3174</code> is perhaps not a 
                dot.
            </p>
            <p>Simply let's click on this error, and the suspicious glyph gets
                the global focus, as depicted by the image next to this
                paragraph.
            </p>
            <p>Obviously, this glyph is not a dot. What is it? 
                It seems to be part of a small half circle, which got cut by the
                image border. Let's try to fix that, by "merging" the two parts
                of the half circle.
                <br/>
                We select the two parts, for example by using a "lasso" as in:
                <img width="139" height="46" src="../images/lasso.png" />
            </p>
            <p>Once the two glyphs are selected, we can click on the 
                <code>SLUR</code> shape if it appears in the top 5 shapes of 
                the Eval board. 
                If not, we use a right-click to get the context popup menu
                <code>Glyphs...</code> | 
                <code>Build compound as...</code> | <code>Others</code> |
                <code>SLUR</code>.</p>
            <p>The two parts are now merged in a single glyph, which is assigned
                the <code>SLUR</code> shape.</p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="glyph-assignment">
                Glyph assignment
            </h3>
            <p>The previous section (using a glyph merge) has already used a 
                glyph assignment (via Eval board or context menu).</p>
            <p>Let's recap the various assignments ways:</p>
            <ul>
                <li>Evaluation board, by clicking in one of the top 5 shapes
                    proposed.</li>
                <li>Context menu, by navigating to the desired shape by
                    <code>Glyphs...</code> | <code>Assign glyph as...</code>
                    | etc,

                </li>
                <li>Shape palette. In the Shape board, open the proper shape
                    set, and use a double-click on the desired shape.
                </li>
                <li>Copy / paste a shape from one glyph to another. 
                    Use the context menu on the first glyph and select 
                    <code>Glyphs...</code> | <code>Copy &lt;SHAPE&gt;</code>,
                    then use the context menu on the other glyph and select
                    <code>Glyphs...</code> | <code>Paste &lt;SHAPE&gt;</code>.
                </li>
            </ul>
            <p>We can add another way, using the Glyph board, since clicking
                on the <code>Deassign</code> button allows to manually
                deassign a glyph shape.</p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="glyph-split">
                Glyph split
            </h3>
            <img class="side" title="no-embraced-note" alt="no-note"
                 width="304" height="318" src="../images/no-note.png" />
            <p>Let's click on another signalled error, which says:
                <br/>
                <code>S3 [glyph#5076] PAGES Slur with no embraced notes</code>
            </p>
            <p>Here we have a pack of pixels which results from two overlapping
                objects, a flag and a rest, and the program has been unable to
                split this big glyph into proper components.
                Let's do this manually.</p>
            <br class="clear"/>
            <img class="side" title="visible sections" alt="sections"
                 width="204" height="261" src="../images/chula-sections.png"/>
            <p>We have to work at the section level. 
                To do so, use <code>Views</code> | <code>Enable section 
                    selection</code>.
                The sections boundaries are now visible, as you can see on the
                picture next to this paragraph.
            </p>
            <br class="clear"/>
            <img class="side" title="splitting sections" alt="splitting-sections"
                 width="429" height="250" 
                 src="../images/chula-split-section.png"/>
            <p>Using the left mouse
                button, while pressing down the <code class="key">CTRL</code>
                key, allows the user to select as many sections as desired.
            </p>
            <p>
                Since sections are usually small, the selection gesture is a bit
                simplified when compared to glyph selection:
                You don't even have to release the mouse button when moving from
                one section to the other, simply browse the sections as you 
                would do with an eraser, and all the touched sections will be
                added to the selection in a "greedy" mode.
                To really remove a given
                section from the current selection, release the mouse button and
                press down the button again on the section to remove (always
                keeping the <code class="key">CTRL</code> key pressed).
                <br/>
                Note, as you select the sections of the "eighth rest" portion of
                the glyph, that the Eval board continuously tries to recognize
                a shape out of the selected sections. 
            </p>
            <p>
                When you have selected all the sections that compose the eighth 
                rest, the <code>EIGHTH_REST</code> button should appear in the 
                top 5.
                <br/>
                Simply click on the related button, and the shape is assigned 
                to a new glyph composed of the selected sections.
                <br/>
                [You can also, when your section selection is ready, use
                a right click to open the context popup menu and use the 
                <code>Glyphs...</code> | <code>Assign glyph as...</code> item.]
            </p>
            <br class="clear"/>
            <img class="side" src="../images/chula-split-glyph.png" 
                 width="207" height="263"
                 alt="Glyph split" title="Glyph split" />
            <p>
                Immediately, the remaining part of the former "big" glyph is
                recognized as a flag.
                You can switch back to the normal glyph-level selection mode.
            </p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="glyph-insertion">
                Glyph insertion
            </h3>

            <p>
                In the section above, we have been lucky that the separation 
                between the two glyphs could be found by aggregating sections. 
                But these splits on section borders are not always satisfactory.
                In that case, the solution is to inject the needed glyphs 
                directly into the sheet structure.
            </p>
            <img class="side" title="Cleaned glyph" alt="cleaned glyph"
                 width="483" height="154" src="../images/cleaned-glyph.png" />
            <p>
                For the sake of example, let's suppose that the split above had
                not been performed. 
                So, we still have this big glyph instead of clearly
                separated flag glyph and eighth rest glyph. So we'll inject them.
            </p>
            <p>
                First let's get rid of assigned shapes (<code>FLAG_1</code> and
                <code>SLUR</code>), by using the  <code>Deassign</code> button,
                until no more shape is assigned.
                <br/>
                Note that when a shape is manually deassigned, the program tries
                to assign another shape, hence the need for perhaps multiple
                deassignments.
                We could also directly assign a <code>CLUTTER</code> shape, to
                avoid these multiple deassignments.
                The picture presents the "cleaned" glyph.
            </p>
            <br class="clear"/>
            <img class="side" title="Flag being dragged" alt="dragged flag" 
                 width="303" height="181"
                 src="../images/chula-dragged-flag.png" />
            <p>
                In the shape palette, we now select the range dedicated to
                flags, and then drag the suitable flag shape from the palette 
                to the sheet view. 
                In the picture, you can see the ghost image of the flag 
                being dragged.
            </p>
            <p>
                We pay attention to correctly position the flag along the stem,
                and we release the mouse button.
            </p>
            <br class="clear"/>
            <img class="side" title="Virtual flag and virtual rest" 
                 alt="Virtual glyphs" width="130" height="150"
                 src="../images/chula-virtual-glyphs.png" />

            <p>
                We perform a similar action for the eighth rest, and we have
                reached the final result.
            </p>


            <p>
                Just a couple of remarks:
            </p>
            <ul>
                <li>For certain shapes, like the flag, it is important to 
                    position the glyph with a rather good precision, otherwise 
                    the distance between the stem and this flag may be larger 
                    than the tolerated margin, and the stem and the flag will 
                    not be recognized as connected.
                </li>
                <li>For the time being, the DnD is rudimentary: once a glyph has
                    been dropped, it cannot be moved. The only workaround is to 
                    delete this virtual glyph (by deassigning it) and reperform
                    the DnD.
                </li>

                <li>Another current limitation is that there is yet no way to
                    resize a virtual glyph. So DnD does not really work for such
                    shapes as beams, slurs, crescendos, descrescendos, ... 
                    These moving / resizing features are postponed until we 
                    integrate a more powerful way to play with glyphs and shape 
                    display (certainly the NetBeans Visual Lib).
                </li>
            </ul>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="text-correction">
                Text correction
            </h3>
            <p>
                Text-shaped items are processed by the OCR engine to retrieve
                their actual content.
            </p>
            <p>
                Make sure to select the proper language to get the best OCR 
                results.
                You can still change the language afterwards to automatically
                recall OCR on the detected words, but the best results are 
                achieved when the right language is chosen upfront.
            </p>
            <p>
                Even with proper language selected, some texts are not correctly
                OCR'ed.
            </p>
            <ul>
                <li>In the Chula example at hand, the number "<code>31</code>"
                    was not detected in the the upper right corner. 
                    The solution is to select the glyph by a "lasso" and assign
                    the TEXT shape. This triggers the OCR, which should 
                    recognize the proper digits.
                </li>
                <li>
                    Some words may be assigned a wrong OCR value.
                    To fix this, select the related glyph and in the text field
                    of the Glyph board, directly type the correct word value. 
                    You can also modify other attributes of the textual glyph,
                    such as the text role or the text type.
                </li>
            </ul>


            <!-- =========================================================== -->

            <h2 id="advanced" class="chapter">
                Advanced
            </h2>
            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="cli">
                Command line interface
            </h3>
            <p>Here is the summary you get when launching Audiveris with the 
                <code>-help</code> parameter:</p>
            <div id="cli-snippet" class="snippet">
                <textarea cols="95" rows="27" >Command line syntax:
   java [JVM options] -jar &lt;audiveris.jar&gt; [parameters*]
Parameters syntax:
   [-help]                             Prints help about command line interface and stops
   [-batch]                            Specifies to run with no graphic user interface
   [-step (STEPNAME|@STEPLIST)+]       Defines a series of target steps
   [-option (KEY=VALUE|@OPTIONLIST)+]  Defines a series of key=value constant pairs
   [-script (SCRIPTNAME|@SCRIPTLIST)+] Defines a series of script files to run
   [-input (FILENAME|@FILELIST)+]      Defines a series of input image files to process
   [-bench (DIRNAME|FILENAME)]         Defines an output path to bench data file (or directory)
   [-print (DIRNAME|FILENAME)]         Defines an output path to PDF file (or directory)
   [-export (DIRNAME|FILENAME)]        Defines an output path to MusicXML file (or directory)
       
Known step names are in order (non case-sensitive):
   LOAD        : Reload the sheet picture
   SCALE       : Compute general scale
   GRID        : Retrieve the grid of all systems
   SYSTEMS     : Split all data per system
   MEASURES    : Retrieve Measures from Bar sticks
   TEXTS       : Retrieve texts items in each system area
   STICKS      : Extract vertical & horizontal sticks
   SYMBOLS     : Apply specific glyph patterns
   PAGES       : Translate glyphs to score items
   SCORE       : Merge all pages into one score

   PRINT       : Write the output PDF file
   EXPORT      : Export the score to MusicXML file
   PLUGIN      : Launch the default plugin (MuseScore)
                </textarea>
            </div>

            <p>You can also use the executables named <code>audiveris.exe</code>
                or <code>audiveris-console.exe</code> which are just wrappers 
                around the <code>java</code> command.
                This command line syntax is also correct: 
                <code>audiveris.exe [parameters*]</code>, it takes the JVM 
                options declared in the related file 
                <code>audiveris.l4j.ini</code>.
            </p>
            <p>More explanation on Audiveris parameters:</p>
            <dl>
                <dt>-help</dt>
                <dd>Displays the CLI summary as printed above.</dd>
                <dt>-batch</dt>
                <dd>Launches Audiveris without any Graphic User Interface.</dd>
                <dt>-step (STEPNAME | @STEPLIST)+</dt>
                <dd>Performs all the specified steps (including the steps which
                    are mandatory to get to the specified ones).
                    <br>
                    'STEPNAME' can be any one of the step names (the case is
                    irrelevant).
                    <br/>
                    These steps will be performed on each sheet referenced from
                    the command line.
                </dd>
                <dt>-option (KEY=VALUE | @OPTIONLIST)+</dt>
                <dd>Specifies the value of some application parameters (that can
                    also be set via the pull-down menu <code>Tools</code> |
                    <code>Options</code>).
                    <br/>
                    You can state key=value pairs or reference an options file 
                    (flagged by an @ sign) that lists key=value pairs (or
                    even other files recursively).
                    <br/>
                    A list file is a simple text file, with one key=value pair
                    per line.
                    <b>Nota</b>: The syntax used is the Properties syntax, so 
                    for example back-slashes must be escaped.</dd>
                <dt>-script (SCRIPTNAME | @SCRIPTLIST)+</dt>
                <dd>Specifies some scripts to be read, using the same mechanism 
                    than input command belows.
                    <br/>
                    These script files contain actions generally recorded during
                    a previous run.
                </dd>
                <dt>-input (FILENAME | @FILELIST)+</dt>
                <dd>Specifies some image files to be read, either by naming the 
                    image file or by referencing (flagged by an @ sign) a file
                    that lists image files (or even other files list recursively).
                    A list file is a simple text file, with one image file name
                    per line.</dd>
                <dt>-bench (DIRNAME | FILENAME)</dt>
                <dd>Defines an output path to bench data file (or directory).
                    <br/>
                    This bench data is meant for application monitoring only.
                    <br/>
                    <b>Nota</b>: If the path refers to an existing directory, 
                    each processed score will output its bench data to a score
                    specific file created in the provided directory. Otherwise,
                    all bench data, whatever its related score, will be written
                    to the provided single file.</dd>
                <dt>-print (DIRNAME | FILENAME)</dt> 
                <dd>Defines an output path to PDF file (or directory).
                    <br/>
                    Same note as for -bench option.</dd>
                <dt>-export (DIRNAME | FILENAME)</dt>
                <dd>Defines an output path to MusicXML file (or directory).
                    <br/>
                    Same note as for -bench option.</dd>
            </dl>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="script">
                Script
            </h3>
            <p>Every user action that can impact the result is recorded in the 
                current score script. 
            </p>
            <p>
                By default, you are prompted to save the script when the score 
                is closed.
                You can override this behavior via the menu <code>Score</code> | 
                <code>Set parameters...</code> or directly by setting the 
                constant <code>omr.script.ScriptActions.closeConfirmation</code>.
            </p>
            <p>
                For example, say you load the file <code>chula.png</code>, set
                the default language to French (code is <code>fra</code>) in the 
                score parameters and launch the <code>EXPORT</code> step.
                You should by default get the following script 
                (<code>scripts/chula.script.xml</code>):
            </p>
            <div id="script-snippet" class="snippet">
                <pre>
&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;script file="examples\chula.png"&gt;
    &lt;parameters foreground="140" language="fra" slot-margin="0.5" slot-policy="HEAD_BASED"/&gt;
    &lt;step name="EXPORT"/&gt;
&lt;/script&gt;</pre>
            </div>
            <p>Such scripts can be replayed later. Knowledgeable users can even
                write scripts from scratch and typically submit them in
                batch mode.
            </p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="plugins">
                Plugins
            </h3>
            <p>The <code>Plugins</code> menu is based on the content of the
                <code>plugins</code> folder of Audiveris. 
                Each file, with a <code>.js</code> extension, found in this 
                folder gives birth to a corresponding item in the Plugins menu.
            </p>
            <div class="right" id="plugins-right"> 
                <div id="plugins-snippet" class="snippet">
                    <pre title="Example of MuseScore plugin">
/* ------------------------------------------------ */
/*              m u s e s c o r e . j s             */
/* ------------------------------------------------ */
    
/* Variable to modify according to your environment */
var <code title="Local path to MuseScore"><b>pathToExec</b></code> = "P:/MuseScore/bin/mscore.exe";
    
/* Title for menu item */
<code title="Menu item"><b>pluginTitle</b></code> = 'MuseScore';
    
/* Long description for tool tip */
<code title="User tip"><b>pluginTip</b></code> = 'Invoke MuseScore on score XML';
    
/* Build sequence of command line parameters */
function <code title="Function to implement"><b>pluginCli</b></code>(exportFilePath) {
    importPackage(java.util);
    return Arrays.asList([pathToExec, exportFilePath]);
}</pre>
                </div>
            </div>
            <p>Let's take the example of <code>musescore.js</code> plugin:</p>
            <p>The purpose of a plugin file is to describe the way an executable
                must be launched.
                Note that the plugin does not actually call the
                executable, Audiveris Java application does this, based on the
                informations provided by the plugin.</p>
            <p>The plugin is implemented as a small piece of 
                JavaScript with just 4 items:
            </p>
            <dl>
                <dt class="high">pathToExec</dt>
                <dd>This local variable defines the exact path to the executable
                    as installed on your own environment.
                    Generally, this item is the only one which needs to be 
                    customized.</dd>
                <dt class="high">pluginTitle</dt>
                <dd>This variable defines the title to be used by the related
                    menu item.</dd>
                <dt class="high">pluginTip</dt>
                <dd>This variable defines a longer string, to be displayed as
                    the tip related to the menu item.</dd>
                <dt class="high">pluginCli</dt>
                <dd>This is a function provided with the single parameter 
                    <code>exportFilePath</code> which contains the path to the 
                    MusicXML file exported by Audiveris. 
                    The returned value must be the precise sequence of command
                    arguments used when launching the target executable.</dd>
            </dl>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="options">
                Options
            </h3>

            <p>
                This interface, accessible from menu <code>Tool</code> | 
                <code>Options</code>, allows to interactively display and
                modify data related to Audiveris classes.
            </p>
            <p>
                The display combines a tree of classes on the left side, and a 
                table on the right side, where details of the logical constants
                from the containing classes are available for display and 
                modification.
            </p><img src="../images/options.png"  alt="options"
                     width="658" height="313"
                     title="User Interface to edit options" />
            <p>
                The picture represents a typical Options view:
            </p>
            <ol>
                <li>We are in the package named <code>util</code>, (actually, 
                    its full name is <code>omr.util</code>, but we drop
                    the ubiquitous <code>omr.</code> prefix) and the class named
                    <code>OmrExecutors</code>, in charge of the tasks handling.
                </li>
                <li>This class has a logging level, currently assigned to 
                    <code>INFO</code>. This information comes from the
                    <code>settings/logging.properties</code> file, but can be 
                    modified on the fly, thanks to this interface, to any
                    legal logging value (such as DEBUG, INFO, etc...).
                    <br/>
                    <b>NOTA</b>: these logging level modifications are meant
                    to be temporary, and thus not stored on disk. For persistent 
                    modification, please edit the logging property file directly.
                </li>
                <li>The class also contains some logical constants, which are
                    application-level parameters, whose precise value is kept 
                    separate from the algorithmic code. 
                    <br/>
                    For example, the constant <code>useParallelism</code> is a 
                    <code>Constant.Boolean</code>.
                    If set to true (its default value) it allows to take
                    advantage of all physical processors available.
                </li>

            </ol>
            <p>To ease the retrieval of pertinent constants, you can use the
                search field located in the upper part of the Options window.
                Here, we have just entered the string "parallel" in this field.
            </p>
            <p>
                How do we define the current value of such logical constant?
                The JavaDoc of class <code>omr.constant.ConstantManager</code>
                explains the mechanism in details. 
                In short, the overriding sequence is defined as follows, from 
                lower to higher priority:
            </p>
            <ol>
                <li>SOURCE: The default value as defined in the source code
                </li>
                <li>DEFAULT: The value, if any, found in file <code>
                        settings/run.default.properties</code>
                </li>
                <li>USER: The value, if any, found in file <code>
                        run.properties</code>
                </li>
                <li>CLI: The value, if any, specified in the command line by a
                    <code>-option key=value</code>. 
                    The CLI value is persisted in the USER file when running in 
                    interactive mode, and not persisted when running in batch.
                </li>
                <li>UI: The value, if any, specified through the 
                    <code>Tools</code> | <code>Options</code> user interface. 
                    These UI values are persisted in the USER file.
                </li>
            </ol>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="training">
                Training
            </h3>

            <p>
                Audiveris has the ability to train the underlying Neural Network 
                evaluator with representative samples.
            </p>
            <p>
                Note that the program is released with a pre-trained evaluator
                so the casual user can safely ignore this training section.
                However, if the score(s) you want to transcribe use some 
                specific music font significantly different from the provided
                examples, you may consider training the evaluator to better fit
                your case.
            </p>

            <h4 id="persist-manuals">
                Persistence of manual assignments
            </h4>

            <img title="Persist Manuals" class="side" width="275" height="194"
                 src="../images/persist-manuals.png" />

            <p>
                You can set a mode in which any manual assignment will be saved
                as a training sample. 
                This allows to record isolated samples on the fly and thus make
                them be available for a future training of the shape evaluator.
                <br/>
                This data is saved under the <code>/train/samples</code> folder.
            </p>
            <p>
                This mode is disabled by default.
                To enable the feature, use the
                menu item <code>Tools</code> | <code>Persist Manuals</code>.
                From that point on, any manually assigned glyph will be saved,
                until the program is exited or the mode is manually reset.
            </p>


            <h4 id="save-score-samples">
                Saving all score samples
            </h4>

            <img title="Save Score Samples" class="side" width="292" height="195"
                 src="../images/save-samples.png" />

            <p>
                When you are really confident with all the glyphs recognized in
                the current sheet, you can decide to save as a whole the 
                complete set of glyphs as training samples.
                <br/>
                This data is saved under the <code>/train/sheets</code> folder.
            </p>

            <h4 id="sample-verifier">
                Sample verifier
            </h4>

            <p>
                The purpose of this "Sample Verifier" is to provide a user 
                interface to visually review some or all of the
                various glyphs which are used for training the evaluator.
            </p>

            <p>
                The main objective is thus to easily identify samples which have
                been assigned a wrong shape. 
                Using them as part of the training base could severely impact
                the recognition efficiency of the evaluator. 
                So the strategy, when such a wrong glyph has been identified, 
                is simply to delete the glyph from the base.
            </p>
            <img src="../images/training_material.png" alt="Sample verifier"  
                 title="User Interface to verify the training samples" 
                 class="right" width="644" height="507"/>
            <p>
                Here is an example of the glyph verifier.
                The top panels are dedicated to selectors, in that order:
            </p>
            <dl>

                <dt>Folders<dt> 
                <dd>This selector allows to select one or several folders to 
                    search for training material within:
                    <ul>
                        <li><code>/train/symbols</code> for artificial symbols,</li>
                        <li><code>/train/samples</code> for isolated samples,</li>
                        <li><code>/train/sheets</code> for whole sheets.</li>
                    </ul>
                </dd>
                <dt>Shapes</dt>
                <dd>This selector displays only the shapes contained in the 
                    folders selected.
                    Select your shapes of interest.
                </dd>
                <dt>Glyphs</dt>
                <dd>This selector displays only the glyphs corresponding to
                    the shapes selected (within the folders selected). 
                    Select your glyphs of interest.
                </dd>
            </dl>
            <p>
                The large panel, on the lower right side, is dedicated to the 
                display of the selected glyphs, using their own coordinates. 
                Notice that glyphs that belong to separate sheets can happen to 
                have close coordinates and thus be displayed as overlapping 
                glyphs.
            </p>
            <p>
                The lower left panel is composed of two main parts:
            </p>
            <ol>
                <li>The <b>Sample</b> navigator drives the loading and display
                    of glyphs from the selection that comes out of the selectors.
                    You can browse through the loaded glyphs.
                </li>

                <li>The <b>Glyph</b> panel, similar to the Glyph board that 
                    appear on the main Audiveris windows, is used to display 
                    information about the glyph at hand, together with the 
                    evaluations performed by the Neural Network evaluator. 
                    The <code>Remove</code> button can be used to discard a 
                    wrong glyph: 
                    this is implemented through the mere deletion of the 
                    underlying glyph XML file.
                </li>
            </ol>
            <p>
                By default, this user interface looks for glyphs files under
                the <code>/train</code> directory.
                However, from the <a href="#trainer">Trainer</a> user interface,
                you can ask to <b>Verify</b> glyphs. 
                In that case, the <b>Sample verifier</b> interface is 
                automatically loaded with the glyphs that failed the validation.
            </p>

            <h4 id="trainer">
                Trainer
            </h4>
            <p>
                This interface is dedicated to the training of the Neural
                Network evaluator.
            </p>
            <img class="right" width="645" height="396" 
                 src="../images/trainer.png" alt="Trainer"
                 title="User Interface to train the evaluator"  />
            <dl>
                <dt>Selection</dt>
                <dd>This panel is in charge of selecting and loading the glyph 
                    XML files, as stored from the predefined symbols and from
                    previous sheet recognitions.
                    <p>
                        Use the <code>Select Core</code> button when you want to 
                        identify a representative <b>Core</b> part within the 
                        whole glyph base.
                        The <code>/train/core</code> directory will be emptied 
                        and repopulated by the core selected glyph files.
                    </p>
                <dt>Neural Training</dt>
                <dd>Here we launch and monitor the training of the neural 
                    network.
                    <br/>
                    On the left, radio buttons allow to select either the 
                    <code>Whole</code> base (default option) or the 
                    <code>Core</code> base.
                    <p>The main decision is to choose between a 
                        <code>Re-Train</code>, which consists in retraining from
                        scratch, or only an <code>Inc-Train</code>, which works
                        incrementally on top of the previous training sessions.
                    </p>
                    <p>For the advanced user, several convergence parameters can
                        be adjusted (although they should be kept close to their 
                        default values): the <code>Momentum</code> and
                        <code>Learning Rate</code>.
                    </p>
                    <p>The training ends when any of the thresholds <code>Max 
                            Error</code> (residual error) or <code>Epochs</code>
                        (number of iterations) is reached, or when the 
                        <code>Stop</code> button is manually pressed.
                        The trainer continuously stores on disk the snapshot of
                        the latest best configuration. 
                        This is the default behavior, but you can also force the 
                        trainer, via the <code>Use Last</code> button, to select
                        only the last configuration.
                    </p>
                </dd>

                <dt>Validation</dt>
                <dd>At any time, even while the neural network is being trained,
                    you can test the evaluator against the selected population 
                    (either the Whole base, or the Core base, according to the
                    selection made via the radio buttons. Note that we can train
                    and validate on different bases).
                    <p>
                        The samples which are either not recognized or (worse) 
                        mistaken for another shape are pointed out.
                        The corresponding <code>Verify</code> buttons launch the 
                        <a href="#sample-verifier">Sample verifier</a> on the 
                        questionable samples to allow a visual check and perhaps 
                        the removal of some of them.</p>
                </dd>

                <dt>Regression Training</dt>
                <dd>This allows to compute the parameters of a linear evaluator,
                    which is less and less used. You can safely ignore this.</dd>
            </dl>

            <!-- =========================================================== -->

            <h2 id="internals" class="chapter">
                Internals
            </h2>
            <p>Audiveris is not just a music scanning program.
                It is also a tool meant to ease the analysis and the 
                development of OMR techniques.
            </p>
            <p>
                To this end, Audiveris is released with an open source license,
                and this chapter details the purpose and the outputs
                of each formalized program step.
            </p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="load-step">
                Load step
            </h3>
            <p>This step is usually implicit. Loading an input file, regardless
                how this file is selected, is considered as performing the 
                <code>LOAD</code> step.
            </p>
            <p>
                At any time, by manually selecting the menu <code>Steps</code> |
                <code>Load</code>, you can force the program to reload the input
                file and reach again the same final mandatory step.
            </p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="scale-step">
                Scale step
            </h3>
            <p>By analyzing the histograms of vertical run lengths for black
                (foreground) and white (background), the program retrieves key 
                information about the music sheet.
            </p>
            <p>
                Via <code>File</code> | <code>Display Scale Plots</code> you
                can display both histograms.

            </p>
            <img title="Foreground runs" width="732" height="454"
                 src="../images/chula-scale-black.png" class="right" />
            <p>In this example, the foreground histogram indicates a peak at 
                value <code>3</code>
                which corresponds to the mean staff line thickness.</p>
            <p>If there is no peak above the <code>10%</code> quorum, the image
                is not likely to contain music staves.</p>
            <p>The sharpness of this peak is also a good indication of the
                scan quality and the width at <code>15%</code> is used to define
                line margins.
            </p>
            <p>The second foreground peak value at <code>12</code> is the second
                frequent height and thus corresponds to average beam height.
            </p>
            <img title="Background runs" width="732" height="454"
                 src="../images/chula-scale-white.png" class="right" />
            <p>Similarly, the main background peak at <code>18</code> relates
                to the average background distance from one staff line to the
                other.
            </p>
            <p>Adding foreground peak value <code>3</code> and background 
                peak value <code>18</code> leads to <code>21</code>, which
                is now considered as the main interline value and thus the 
                key scaling factor for the sheet at hand. 
            </p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="grid-step">
                Grid step
            </h3>
            <img title="Grid of staves and barlines" width="436" height="335"
                 src="../images/warped-grid.png" class="right" />
            <p>By aggregating long horizontal sections into filaments, and
                gathering filements into clusters of vertically spaced 
                filaments, Audiveris retrieves staves skeletons.
            </p>
            <p>
                Similarly, long vertical sections are aggregated into barline 
                filaments.
            </p>
            <p>
                The crossing of these horizontal and vertical filaments, 
                sometimes fairly wavy and therefore
                implemented as natural splines, represents a kind of "grid".
                From that point on, this grid is taken as the geometric 
                referential for all other entities.
            </p>    
            <p>
                Note that this intrinsic referential allows Audiveris to 
                directly cope with skewed page and / or wavy lines with no
                deskewing of other processing.
            </p>
            <p>
                If you wish, you can still ask Audiveris to produce a "dewarped"
                image, by using the referential as the dewarping grid.
                Doing so, Audiveris <code>GRID</code> step can also be used as
                a standalone image dewarping preprocessor.
                <br/>
                To compute and display the dewarped image, simply set the 
                constant <code>omr.grid.GridBuilder.buildDewarpedTarget</code>
                to true, 
                and to save the dewarped image to disk set the constant 
                <code>omr.grid.TargetBuilder.storeDewarp</code> to true.
            </p>
            <p>
                See below the initial (warped) image and the final (dewarped) 
                image. Note the pixels colors are not modified, only
                their coordinates are.
            </p>
            <table border="0" >
                <tr>
                    <td>
                        <img title="Warped image" width="436" height="335" 
                             id="warped" src="../images/warped-input.png"/>
                    </td>
                    <td>
                        <img title="Dewarped image" width="436" height="335" 
                             id="dewarped" src="../images/dewarped-output.png"/>
                    </td>
                </tr>
            </table>


            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="systems-step">
                Systems step
            </h3>
            <img title="Edition of system boundaries" class="right"
                 width="442" height="190"
                 src="../images/boundary-edition.png" />
            <p>
                The <code>SYSTEMS</code> step handles the separation between
                systems, and the dispatching of all sections and glyphs to
                their "containing" system.
            </p>
            <p>
                From that point on, most processings will be done at system 
                level.
                This limits the amount of entities (sections & glyphs)
                to search, and allows to process all systems in parallel, thus
                taking advantage of the computer hardware architecture.
            </p>
            <p>
                Audiveris tries to define a "smart" border between adjacent
                systems which assigns the glyphs to the system they logically
                belong to.
            </p>
            <p>
                You can still manually modify the border, by starting a boundary
                edition session via the (right-click) context menu
                <code>Boundaries...</code> | <code>Start</code>.
                The broken lines of all boundaries are highlighted in red color.
                With the mouse, you can adjust the border by simply dragging the
                lines and points.
                When you are done, end the session by 
                <code>Boundaries...</code> | <code>Complete</code> so that
                modifications are immediately taken into account.
            </p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="measures-step">
                Measures step
            </h3>
            <img title="Measures" class="right" width="411" height="191"
                 src="../images/measures.png" />
            <p>
                The <code>MEASURES</code> step uses the barlines candidates to
                build and check the measures of every system. 
                Global measure consistency is further checked for systems that
                contain more than a single staff.
            </p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="texts-step">
                Texts step
            </h3>
            <img title="Texts" class="right" width="612" height="205"
                 src="../images/chula-system-text.png" />
            <p>
                The <code>TEXTS</code> step works on each system in 
                parallel.
            </p>
            <p>
                It first builds an image of the system area, hiding all glyphs 
                which are too wide or too high, or which intersect a staff 
                interior.
            </p>
            <p>
                It then hands this filtered system image over to the OCR engine,
                which performs a layout analysis of the image and the 
                transcription of the detected text blocks.
            </p>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="sticks-step">
                Sticks step
            </h3>
            <img title="Vertical & horizontal sticks" class="right" 
                 width="342" height="196" src="../images/sticks.png" />
            <p>
                The <code>STICKS</code> step searches systems for sticks, either
                horizontal or vertical.
            </p>
            <ul>
                <li>Horizontal sticks are further checked to be assigned the 
                    <code>LEDGER</code> shape.</li>
                <li>Vertical sticks gave birth to <code>STEM</code> entities.
                </li>
            </ul>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="symbols-step">
                Symbols step
            </h3>
            <img title="Identified symbols" class="right" 
                 width="342" height="196" src="../images/symbols.png" />
            <p>
                The <code>SYMBOLS</code> step aggregates unassigned sections 
                that connect either horizontally or vertically into glyphs.
            </p>
            <p>For each glyph, Audiveris computes a series of key parameters
                based on ART moments (Angular Radial Transform moments as used
                by MPEG-7) and feeds the Neural Network evaluator to look for a
                suitable shape.
            </p>
            <p>Several dedicated patterns are run at system level to further 
                check and correct the glyphs assignments.
            </p>
            <p>The <code>SYMBOLS</code> step iterates at system level on the
                cycle: aggregation / assignment / patterns.
            </p>
            <p>
                The final glyphs are displayed with a color that is specific
                to their assigned shape.
            </p>
            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="pages-step">
                Pages step
            </h3>
            <img title="Translated entities" class="right" 
                 width="342" height="196" src="../images/pages.png" />
            <p>
                The <code>PAGES</code> step works at page level to translate
                all assigned glyphs to their corresponding score logical 
                entities.
            </p>
            <p>
                Global consistency checks are run at page level, to adjust 
                parameters such as the time signatures.
            </p>
            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <h3 id="score-step">
                Score step
            </h3>
            <img title="Score voices" class="right" 
                 width="297" height="209" src="../images/voices.png" />
            <p>
                The <code>SCORE</code> step connects the various pages of a
                multi-page score (this step is almost void for a single-page
                score):
            </p>
            <ul>
                <li>Connection of system parts (including voices and
                    instruments) across pages</li>
                <li>Global measure numbering</li>
                <li>Use of time signatures to check measure durations</li>
                <li>Connection of orphaned slurs across pages</li>
            </ul>
            <p>
                Using menu <code>Views</code> | <code>Show score voices</code>,
                or the related <code class="key">F11</code> key, you can
                visualize the voices with different colors as shown on the 
                presented picture.
            </p>

            <p>Nota:</p>
            <ul>
                <li>For the time being, the <code>SCORE</code> step works on the 
                    pages loaded as parts of the multi-page score in memory.
                </li>
                <li>For large scores that won't fit in memory, a different
                    approach is needed, whereby pages will be separately 
                    recognized and saved as MusicXML files. 
                    An offline final reduction task will then run to connect 
                    these pages XML files.
                    Further work is still to be done, but a prototype is already 
                    available in the <code>omr.score.ScoreXmlReduction</code>
                    class.
                </li>
            </ul>
        </div>
    </body>
</html>
